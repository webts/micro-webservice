{"version":3,"sources":["../../lib/utils/factory.js"],"names":["pkg","require","module","exports","buildService","config","serviceClass","clazz","endsWith","indexOf","startsWith","path","resolve","parts","split","name","console","log","__dirname","default","npm","length","i","error","Error","instance","err"],"mappings":";;AAAA;;AACA;;;;AAEA,MAAMA,MAAMC,QAAQ,oBAAR,CAAZ;AAEA;;;;;;;AAKAC,OAAOC,OAAP,CAAeC,YAAf,GAA8B,gBAAeC,MAAf,EAAsB;AAEhD,MAAIC,eAAeD,OAAOC,YAA1B;AACA,MAAIC,QAAQ,IAAZ;;AACA,MAAG;AACC;AACA,QAAGD,aAAaE,QAAb,CAAsB,KAAtB,KAAgCF,aAAaG,OAAb,CAAqB,GAArB,IAA4B,CAA/D,EAAiE;AAC7D,UAAGH,aAAaI,UAAb,CAAwB,IAAxB,CAAH,EACIJ,eAAeK,cAAKC,OAAL,CAAa,SAAb,EAAwBN,YAAxB,CAAf;AACJC,cAAQN,QAAQK,YAAR,CAAR;AACH,KAJD,MAKK,IAAGA,aAAaG,OAAb,CAAqB,GAArB,IAA4B,CAA/B,EAAiC;AAClC,YAAMI,QAAQP,aAAaQ,KAAb,CAAmB,GAAnB,CAAd;;AAEA,UAAGD,MAAM,CAAN,MAAab,IAAIe,IAApB,EAAyB;AACzB;AACIC,kBAAQC,GAAR,CAAYC,YAAY,WAAZ,GAA0BL,MAAM,CAAN,CAAtC;AACAN,kBAAQN,QAAQ,aAAaY,MAAM,CAAN,CAArB,EAA+BM,OAAvC,CAFJ,CAGI;AACH,SALD,MAMI;AACA,cAAMC,MAAMnB,QAAQY,MAAM,CAAN,CAAR,CAAZ;;AACA,YAAGA,MAAMQ,MAAN,GAAe,CAAlB,EAAoB;AAChBd,kBAAQa,GAAR;;AACA,eAAI,IAAIE,IAAE,CAAV,EAAYA,IAAIT,MAAMQ,MAAtB,EAA8BC,GAA9B,EAAkC;AAC9Bf,oBAAQA,MAAMM,MAAMS,CAAN,CAAN,CAAR;AACH;AACJ,SALD,MAKK;AACDN,kBAAQO,KAAR,CAAc,IAAIC,KAAJ,CAAU,yBAAV,CAAd;AAEA,iBAAO,IAAP;AACH;AACJ;AACJ,KAtBI,MAuBD;AACAjB,cAAQN,QAAQK,YAAR,CAAR;AACH;;AAED,UAAMmB,WAAW,IAAIlB,KAAJ,CAAUF,MAAV,CAAjB;AAEA,WAAOoB,QAAP;AACH,GArCD,CAsCA,OAAMC,GAAN,EAAU;AACNV,YAAQO,KAAR,CAAcG,GAAd;AACH;;AAED,SAAO,IAAP;AACH,CA/CD","sourcesContent":["import path from 'path';\r\nimport debug from 'debug';\r\n\r\nconst pkg = require('../../package.json');\r\n\r\n/**\r\n * create service from serveless yaml config file\r\n * \r\n * @param {any} path \r\n */\r\nmodule.exports.buildService = async function(config){\r\n\r\n    let serviceClass = config.serviceClass;\r\n    let clazz = null;\r\n    try{\r\n        //load directly from path\r\n        if(serviceClass.endsWith('.js') || serviceClass.indexOf('/') > 0){\r\n            if(serviceClass.startsWith('./'))\r\n                serviceClass = path.resolve('./build', serviceClass);\r\n            clazz = require(serviceClass);\r\n        }\r\n        else if(serviceClass.indexOf('.') > 0){\r\n            const parts = serviceClass.split('.');\r\n            \r\n            if(parts[0] === pkg.name)//this package\r\n            {\r\n                console.log(__dirname + '/../core/' + parts[1])\r\n                clazz = require('../core/' + parts[1]).default;\r\n                //console.log('class ' + clazz);\r\n            }\r\n            else{\r\n                const npm = require(parts[0]);\r\n                if(parts.length > 1){\r\n                    clazz = npm;\r\n                    for(let i=1;i < parts.length; i++){\r\n                        clazz = clazz[parts[i]];\r\n                    }\r\n                }else{\r\n                    console.error(new Error('Invalid class signature'));\r\n\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            clazz = require(serviceClass);\r\n        }\r\n\r\n        const instance = new clazz(config);\r\n\r\n        return instance;\r\n    }\r\n    catch(err){\r\n        console.error(err);\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\n"],"file":"factory.js"}